<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="655" height="600" viewBox="0 0 655 600"><script type="text/ecmascript"><![CDATA[
var svgns   = "http://www.w3.org/2000/svg";
var xlinkns = "http://www.w3.org/1999/xlink";

var SCALE="scale";
var DRAG="drag";

var action, actionNode, actionTgt;
var dx, dy;
var imgGroup = document.getElementById("imgGroup")
var filter   = imgGroup.getAttribute("style");
var dragged=false;

function dragOn(evt) {
  actionNode = evt.target;
  action = DRAG;
  var currX = parseFloat(actionNode.getAttribute("x"));
  var currY = parseFloat(actionNode.getAttribute("y"));
  var nowToX = evt.clientX;
  var nowToY = evt.clientY;

  // handle the current zoom and pan
  var trans = document.documentElement.currentTranslate;
  var scale = document.documentElement.currentScale;
  nowToX = (nowToX - trans.x) / scale;
  nowToY = (nowToY - trans.y) / scale;

  dx = nowToX-currX;
  dy = nowToY-currY;
  dragged=false;
}

function scaleOn(evt) {
  actionNode = actionTgt;
  action = SCALE;
  var cW = parseFloat(actionNode.getAttribute("width"));
  var cH = parseFloat(actionNode.getAttribute("height"));
  var nowToX = evt.clientX;
  var nowToY = evt.clientY;

  // handle the current zoom and pan
  var trans = document.documentElement.currentTranslate;
  var scale = document.documentElement.currentScale;
  nowToX = (nowToX - trans.x) / scale;
  nowToY = (nowToY - trans.y) / scale;

  dx = nowToX-cW;
  dy = nowToY-cH;
  dragged=false;
}

function dragScaleOff() {
  if (dragged) imgGroup.setAttribute("style",filter);

  if (actionNode != null) {
    if (actionNode != imgGroup.lastChild) {
       imgGroup.appendChild(actionNode);
    }
    actionNode = null;
  }
}

function dragScaleImgBg(evt) {
  if (actionNode == null) {
        hideOverlay();
        return;
  }
  dragScaleImg(evt);
}

function dragScaleImg(evt) {
  if (actionNode == null) return;

  dragged = true;
  imgGroup.setAttribute("style","");
  if (actionNode != imgGroup.lastChild) 
      imgGroup.appendChild(actionNode);

  var nowToX = evt.clientX;
  var nowToY = evt.clientY;

  // handle the current zoom and pan
  var trans = document.documentElement.currentTranslate;
  var scale = document.documentElement.currentScale;
  nowToX = (nowToX - trans.x) / scale;
  nowToY = (nowToY - trans.y) / scale;

  if (action == DRAG) {
    actionNode.setAttribute("x",""+(nowToX-dx));
    actionNode.setAttribute("y",""+(nowToY-dy));
  } else {
    var cW = parseFloat(actionNode.getAttribute("width"));
    var cH = parseFloat(actionNode.getAttribute("height"));

    var ar = cW/cH; 
    var nW = nowToX-dx;
    var nH = nowToY-dy;

    if (nW/nH < ar) { nW = ar*nH; }
    else            { nH = nW/ar; }

    actionNode.setAttribute("width", ""+nW);
    actionNode.setAttribute("height",""+nH);
  }

  updateOverlay(actionNode);
}

function updateOverlay(tgt) {
  var cX = parseFloat(tgt.getAttribute("x"));
  var cY = parseFloat(tgt.getAttribute("y"));
  var cW = parseFloat(tgt.getAttribute("width"));
  var cH = parseFloat(tgt.getAttribute("height"));

  var over = document.getElementById("overlay");
  over.setAttribute("transform","translate("+(cX+cW-1)+","+(cY+cH-1)+")");
  actionTgt = tgt;
}

function showOverlay(evt) {
  if (actionNode != null) return;
  updateOverlay(evt.target);
  document.getElementById("overlay").setAttribute("visibility","visible");
}

function hideOverlay() {
  if (actionNode != null) return;
  document.getElementById("overlay").setAttribute("visibility","hidden");
  actionTgt=null;
}
 ]]></script><filter id="merge" filterUnits="objectBoundingBox"><feMorphology in="SourceAlpha" operator="dilate" radius="10"/><feGaussianBlur stdDeviation="4"/><feOffset dx="3" dy="3"/><feComponentTransfer result="shadow"><feFuncA intercept="0" slope=".6" type="linear"/></feComponentTransfer><feComposite in="SourceGraphic" in2="shadow" operator="over"/></filter><rect width="100%" height="100%" x="0%" y="0%" fill="#88A"/><text x="302" y="47" fill="#448" font-size="24">Click and drag to move images</text><text x="300" y="45" fill="#fff" font-size="24">Click and drag to move images</text><rect width="100%" height="100%" x="0%" y="0%" fill="none" onmousedown="dragScaleOff()" onmousemove="dragScaleImgBg(evt)" onmouseup="dragScaleOff()" pointer-events="fill"/><g id="imgGroup" onmousedown="dragOn(evt)" onmousemove="dragScaleImg(evt)" onmouseover="showOverlay(evt)" onmouseup="dragScaleOff()" style="filter:url(#merge)"><image width="360" height="240" x="25" y="315" xlink:href="tests/resources/images/operaSteps.jpg"/><image width="200" height="300" x="50" y="40" xlink:href="tests/resources/images/operaWalk.jpg"/><image width="360" height="240" x="270" y="200" xlink:href="tests/resources/images/operaBridge.jpg"/></g><g id="overlay" onmousedown="scaleOn(evt)" onmousemove="dragScaleImg(evt)" onmouseup="dragScaleOff()" visibility="hidden"><path fill="#a9a9a9" stroke="#fff" d="M0,0 h-20 l20,-20 z M-12,-3 l9-9 z M-6,-3 l3-3z"/></g></svg>